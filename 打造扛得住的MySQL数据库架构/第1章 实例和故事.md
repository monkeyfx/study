## 数据库架构
1 * Master -> Slave * 15

1 Slave->Master

网卡故障

QPS & TPS。CPU：64核 内存512GB

35w & 5w

并发量：同一时间处理的请求的数量

700:

CPU 使用率    

1. 服务器性能急剧下降
2. 最好不用在主库上数据库备份
3. 大型活动前取消这类计划

## 影响数据库性能

大表：

>记录行数巨大，单表超过千万行
>表数据文件巨大，表数据文件超过10G

1. 大表对查询的影响

慢查询：很难在一定的时间内过滤出所需要的数据

>来源少
区分度低
大量磁盘IO
降低磁盘效率
大量慢查询

2. 大表对DDL操作的影响

>建立索引需要很长的时间

<font color="red">风险：</font>
MySQL版本<5.5 建立索引会锁表

MySQL版本>=5.5 虽然不会锁表但会主从延迟


修改表结构需要长时间锁表

#####风险：
>会造成长时间主从延迟

影响正常的数据操作（字段修改会造成阻塞 数据库连接数猛增 、锁表）

分库分表把一张大表分成多个小表

#####难点：

>分表主键的选择
>分表后跨分区数据的查询和统计


#### 大表历史数据归档 减少对前后端业务的影响

>归档时间点的选择(一年前)
>如何进行归档操作

### 1-5 大事务带来的问题

1. 事务上数据系统区别于其他一切文件系统的重要特征之一

2. 事务上一组具有原子性的SQL 语句，或是一个独立的工作单元

#### 什么是事务

*原子性*
>定义：整个事务中的所有操作要么全部提交成功，要么全部失败，对于一个事物来说，不可能只执行其中的一部分操作

*事务的一致性*
*事务的隔离型*
在未提交完成前对于其他事务上不可见的

>未提交读(READ UNCOMmitted)
>已提交读(READ COMMITED)
>可重复读（REPEATABLE-READ） innodb
>可串行化(SERIALIZABLE)

隔离性由低到高
并发性由高到低

*事务的持久性*


###大事务
>定义：运行时间比较长，操作的数据比较多的事务
>风险：
1. 锁定太多的数据，造成大量的阻塞和锁超时
2. 回滚时所需时间比较长
3. 执行时间长，容易造成主从延迟

###如何处理大事务

1. 避免一次处理太多的数据
2. 移出不必要在事务中的SELECT操作


###总结
>直观的展示了数据库在繁忙时的系统状态
>简单了解了对性能有影响的一些因素





























































